
#widget
script(src='https://api.sandbox.hyperwallet.com/rest/widgets/transfer-methods/'+hyperusertoken+'/en.min.js')
script(type='text/javascript').
    //create widget
    var hyperun = '#{hyperun}';
    var hyperpw = '#{hyperpw}';
    var hyperwallet_moneytransfer_response = null;
    var hyperusertoken = '#{hyperusertoken}';
    var widget = HWWidgets.transferMethods.configure({
    "template": "bootstrap3",
    "el": document.getElementById("widget"),
    "skipProfileFields": true,
      "transferMethodConfiguration": {
         "profileType": "INDIVIDUAL"
      },
    "onComplete": function (data) {
      $.ajax({
        type: "POST",
        url: 'https://api.sandbox.hyperwallet.com/rest/v3/users/'+hyperusertoken+'/transfer-methods',

        contentType:'application/json',
        beforeSend: function (xhr) {
            xhr.setRequestHeader ("Authorization", "Basic " + btoa(hyperun + ":" + hyperpw));
            xhr.setRequestHeader ("Json-Cache-Token", data.token);
            xhr.setRequestHeader ("Content-Type", "application/json");
            xhr.setRequestHeader ("Accept", "application/json");
        },
        processData: false,
        data: '{"foo":"bar"}',
        dataType:'json',
        success: function(json){
          console.log(json);
          hyperwallet_moneytransfer_response = json;
          step_widzard.bootstrapWizard('next');
        },
        error:function(error){
          console.log(error);
          var msgs = JSON.parse(error.responseText).errors;
          for (var i =0;i<msgs.length;i++)
          toastr.error(msgs[i].message);
        }
      });
      console.log("Received token: " + data.token);
      hyperwallet_moneytransfer_response = data;
      this.setData({});
      /*step_widzard.bootstrapWizard('next');*/
    },
    "onError": function (errors, state) {
      /*step_widzard.bootstrapWizard('next');*/
      console.log(errors);
    }
    });
    widget.create(); //display widget
